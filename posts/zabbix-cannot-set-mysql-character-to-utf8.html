<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <title>记一次 zabbix 数据库编码排错 - Cynosura</title>
    <meta name="description" content="简单记录在 zabbix 5.0 上遇到数据库乱码的解决过程">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Pelican">
    <!--主题色-->
    <meta name="color-scheme" content="light dark">
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#EBF4F4">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#121212">
    <!--Open Graph protocol-->
    <meta property="og:type" content="article">
    <meta property="og:title" content="记一次 zabbix 数据库编码排错 - Cynosura">
    <meta property="og:description" content="简单记录在 zabbix 5.0 上遇到数据库乱码的解决过程">
    <meta property="og:url" content="https://cynosura.one/posts/zabbix-cannot-set-mysql-character-to-utf8.html">
    <meta property="og:image" content="https://cynosura.one/img/banner.webp">
    <!--Twitter Card-->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@astraorsa">
    <meta name="twitter:title" content="记一次 zabbix 数据库编码排错 - Cynosura">
    <meta name="twitter:description" content="简单记录在 zabbix 5.0 上遇到数据库乱码的解决过程">
    <meta name="twitter:image" content="https://cynosura.one/img/banner.webp">
    <!--链接样式-->
    <link rel="stylesheet" type="text/css" href="https://cynosura.one/css/style.css">
    <link rel="icon" type="image/x-icon" href="https://cynosura.one/img/favicon.ico">
    <!--加载字体-->
    <link rel="preload" href="https://cynosura.one/font/Overpass-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://cynosura.one/font/Overpass-Bold.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://cynosura.one/font/OverpassMono-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <!--Sitemap-->
    <link rel="sitemap" type="application/xml" title="Sitemap" href="https://cynosura.one/posts/sitemap.xml">
    <!--Feed RSS-->
    <link rel="alternate" type="application/atom+xml" title="Cynosura Full Atom Feed" href="https://cynosura.one/posts/feeds/all.atom.xml">
</head>
<body>
    <header>
        <img class="header-avatar" src="https://cynosura.one/img/avatar.webp" alt="site-avatar">
        <h1 class="header-title">Cynosura</h1>
        <p class="header-description">Trying to light up the dark.</p>
        <nav class="old-menu" style="display: none;">
            <ul>
                <li><a href="https://cynosura.one" class="menu-link">首页</a></li>
                <li><a href="https://cynosura.one/posts" class="menu-link-active">文章</a></li>
                <li><a href="https://cynosura.one/friends" class="menu-link">友人</a></li>
                <li><a href="https://cynosura.one/about" class="menu-link">关于</a></li>
            </ul>
        </nav>
    </header>
<main class="post-article-main">
    <nav class="menu">
        <div class="menu-a">
            <button class="menu-button" onclick="window.location.href='https://cynosura.one'"><img src="https://cynosura.one/img/icons/home.svg" alt="home-button" class="menu-icon"><span class="menu-button-text">首页</span></button>
            <button class="menu-button-active menu-button" onclick="window.location.href='https://cynosura.one/posts'"><img src="https://cynosura.one/img/icons/article.svg" alt="posts-button" class="menu-icon"><span class="menu-button-text-active">文章</span></button>
            <button class="menu-button" onclick="window.location.href='https://cynosura.one/friends'"><img src="https://cynosura.one/img/icons/links.svg" alt="friends-button" class="menu-icon"><span class="menu-button-text">友人</span></button>
            <button class="menu-button" onclick="window.location.href='https://cynosura.one/about'"><img src="https://cynosura.one/img/icons/about.svg" alt="about-button" class="menu-icon"><span class="menu-button-text">关于</span></button>
        </div>
    </nav>
    <article class="post-article card">
        <div>
            <h1 class="post-article-title">记一次 zabbix 数据库编码排错</h1>
            
        </div>
        <div class="post-article-content">
            <p>这几天在折腾 zabbix 5.x 上奇怪的编码问题，原型规则写的是中文，页面上也正常显示了中文，但 Discover 到具体监控项，以及告警推送就全部变 "???" 了。</p>
<p>查日志报错 cannot set MySQL character set to "utf8"，如图：</p>
<p><img alt="issue-1" src="images/zabbix-cannot-set-mysql-character-to-utf8/issue-1.png"></p>
<p>搜了一圈推测是 zabbix 和 MariaDB 的兼容问题，MariaDB 10.6 不支持直接 'utf8'，只支持具体到 'utf8mb3' 或 'utf8mb4'，而 zabbix 的检测逻辑没考虑到数据库不支持 'utf8' 的情况，而官方问题追踪里说已经在 zabbix 5.0.26 里 <a href="https://support.zabbix.com/browse/ZBX-21301">修了</a>。</p>
<p><img alt="issue-2" src="images/zabbix-cannot-set-mysql-character-to-utf8/issue-2.jpg"></p>
<p>在 zabbix 推出 5.0.26 正式版本之前，建议改用其他数据库，或使用 zabbix 6.x 版本并改用 'utf8mb4' 编码。</p>
        </div>
    </article>
    <div class="post-article-footer">
        <div class="post-article-meta card">
            <h2 class="card-title">本文信息</h2>
                <p><strong>作者: </strong>Frudrax Cheng</p>
            <p><strong>发布时间:</strong>
                <time class="published" datetime="2022-07-22T14:36:10+08:00">
                2022-07-22 (周五)
                </time>
            </p>
            <p><strong>文章分类: </strong>技术</p>
            <p><strong>链接: </strong><a href="https://cynosura.one/posts/zabbix-cannot-set-mysql-character-to-utf8.html" title="记一次 zabbix 数据库编码排错" class="p-link">https://cynosura.one/posts/zabbix-cannot-set-mysql-character-to-utf8.html</a></p>
        </div>
        <div class="post-article-copyright card">
            <h2 class="card-title">版权许可</h2>
            <p><strong>声明: </strong>本文所有内容（包括图片）</p>
            <p>均采用 <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International License">CC BY-SA 4.0</a> 协议授权</p>
            <p>转载请注明出处，并附上本声明内容</p>
            <img class="post-article-copyright-icon" src="https://cynosura.one/img/icons/creative-icon.svg" alt="creative-icon">
            <img class="post-article-copyright-icon" src="https://cynosura.one/img/icons/creative-icon-by.svg" alt="creative-icon-by">
            <img class="post-article-copyright-icon" src="https://cynosura.one/img/icons/creative-icon-sa.svg" alt="creative-icon-sa">
        </div>
    </div>
    <div class="post-article-comments card">
        <h2 class="card-title">评论</h2>
        <p>注: 留言系统基于 <a href="https://disqus.com">Disqus</a>，部分网络环境可能无法正常加载。</p>
        <div id="disqus_thread"></div>
        <!-- 添加一个按钮 -->
        <button id="load_disqus" class="comments-button button">加载评论</button>
        <!-- Disqus 留言板容器 -->
        <div id="disqus_thread_container"></div>
    </div>
    <script>
        // 点击按钮后加载 Disqus 留言板
        document.getElementById('load_disqus').addEventListener('click', function() {
            // 添加 Disqus 留言板脚本
            var disqusScript = document.createElement('script');
            disqusScript.src = 'https://cynosura-one.disqus.com/embed.js';
            disqusScript.setAttribute('data-timestamp', +new Date());
            document.head.appendChild(disqusScript);
            // 移动 Disqus 留言板内容到容器中
            var disqusContainer = document.getElementById('disqus_thread_container');
            disqusContainer.appendChild(document.getElementById('disqus_thread'));
            // 隐藏按钮，防止重复加载
            this.style.display = 'none';
        });
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <footer>
        <p>Designed by <a href="https://cynosura.one">Cynosura</a> &copy 2023</p>
        <script src="https://cynosura.one/js/menu.js" defer></script>
    </footer>
</body>
</html>