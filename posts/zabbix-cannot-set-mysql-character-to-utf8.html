<!DOCTYPE html>
<html lang="zh-cn">
<head>
        <title>Cynosura - 记一次 zabbix 数据库编码排错</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Pelican" />
    <link rel="stylesheet" type="text/css" href="/theme/css/style.css?v=1.6">
    <link rel="icon" type="image/x-icon" href="/theme/img/favicon.ico">





</head>

<body>
    <header class="page-header">
        <div class="avatar">
            <img src="/theme/img/avatar.webp" alt="avatar" />
        </div>
        <div class="title">
            <h1>Cynosura</h1>
            <h2></h2>
        </div>
        <nav class="menu">
            <ul>
                <li><a href="https://cynosura.one" class="menu-link">首页</a></li>
                <li><a href="/" class="menu-link-active">文章</a></li>
                <li><a href="https://cynosura.one/friends" class="menu-link">友人</a></li>
                <li><a href="https://cynosura.one/about" class="menu-link">关于</a></li>
            </ul>
        </nav>
    </header>
<section class="post">
    <header>
        <h2 class="post-title">记一次 zabbix 数据库编码排错</h2>
    
    </header>
    <div class="entry-content">
        <p>这几天在折腾 zabbix 5.x 上奇怪的编码问题，原型规则写的是中文，页面上也正常显示了中文，但 Discover 到具体监控项，以及告警推送就全部变 "???" 了。</p>
<p>查日志报错 cannot set MySQL character set to "utf8"，如图：</p>
<p><img alt="issue-1" src="images/zabbix-cannot-set-mysql-character-to-utf8/issue-1.png"></p>
<p>搜了一圈推测是 zabbix 和 MariaDB 的兼容问题，MariaDB 10.6 不支持直接 'utf8'，只支持具体到 'utf8mb3' 或 'utf8mb4'，而 zabbix 的检测逻辑没考虑到数据库不支持 'utf8' 的情况，而官方问题追踪里说已经在 zabbix 5.0.26 里 <a href="https://support.zabbix.com/browse/ZBX-21301">修了</a>。</p>
<p><img alt="issue-2" src="images/zabbix-cannot-set-mysql-character-to-utf8/issue-2.jpg"></p>
<p>在 zabbix 推出 5.0.26 正式版本之前，建议改用其他数据库，或使用 zabbix 6.x 版本并改用 'utf8mb4' 编码。</p>
    </div>
</section>
<footer class="post-meta">
    <h2>本文信息</h2>
        <p><strong>作者: </strong>Frudrax Cheng</p>
    <p><strong>发布时间:</strong>
        <time class="published" datetime="2022-07-22T14:36:10+08:00">
        2022-07-22 (周五)
        </time>
    </p>
    <p><strong>链接: </strong><a href="/zabbix-cannot-set-mysql-character-to-utf8.html" title="记一次 zabbix 数据库编码排错">/zabbix-cannot-set-mysql-character-to-utf8.html</a></p>
    <div class="copyright">
        <p><strong>版权许可: </strong><a rel="license" href="https://creativecommons.org/licenses/by/4.0" target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International License">署名-相同方式共享 4.0 (CC BY-SA 4.0)</a></p>
        <img class="creative-icon" src="/theme/img/icon/creative_icon.svg" alt="creative_icon" />
    </div>
</footer>
<div class="comments">
    <span class="title-h2"><h2>评论</h2></span>
    <p>注: 留言系统基于 Disqus，可能无法在墙内正常访问</p>
    <div id="disqus_thread"></div>
    <!-- 添加一个按钮 -->
    <button id="load_disqus" class="button">加载 Disqus</button>
    <!-- Disqus 留言板容器 -->
    <div id="disqus_thread_container"></div>
</div>
<script>
    // 点击按钮后加载 Disqus 留言板
    document.getElementById('load_disqus').addEventListener('click', function() {
        // 添加 Disqus 留言板脚本
        var disqusScript = document.createElement('script');
        disqusScript.src = 'https://cynosura-one.disqus.com/embed.js';
        disqusScript.setAttribute('data-timestamp', +new Date());
        document.head.appendChild(disqusScript);
        // 移动 Disqus 留言板内容到容器中
        var disqusContainer = document.getElementById('disqus_thread_container');
        disqusContainer.appendChild(document.getElementById('disqus_thread'));
        // 隐藏按钮，防止重复加载
        this.style.display = 'none';
    });
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <footer class="page-footer">
        <p>Copyright &copy; 2023 Cynosura</p>
        <p>Powered by <a href="https://getpelican.com/">Pelican</a></p>
    </footer>
</body>
</html>